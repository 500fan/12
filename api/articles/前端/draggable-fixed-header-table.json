{"title":"使用粘性定位(position:sticky)实现固定表头、固定列的表格组件(Vue、React)","slug":"前端/draggable-fixed-header-table","date":"2020-08-15T03:00:00.000Z","updated":"2020-11-23T14:37:57.000Z","comments":true,"path":"api/articles/前端/draggable-fixed-header-table.json","excerpt":null,"covers":["https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table2.gif","https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table3.gif","https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_225413.png","https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_224153.png","https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_103321.png","https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_113828.png","https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/resize-table1.gif"],"content":"<p>最近重构的项目中有这样一个页面，一个固定表头和列的表格，表格列数较多，大概有60多列，200多条数据，而且表格需要实现拖拽滚动功能。<br>原页面的表格是用的一个比较老旧的表格插件实现，拖拽滚动是用iScroll.js实现的，性能很差，即使每页只有二、三十条数据，拖拽起来也严重卡顿。我首先使用了element-ui自带的的table组件实现了拖拽滚动的功能，性能稍微比老页面强了一点，每页50条数据时卡顿不明显，超过100条数据时有才有卡顿感。然而我对这样的性能也不是很满意，就研究了下el-table固定表头和列的实现方式，发现el-table实现固定列的方式比较坑，它是渲染了两个完整的table，然后把固定列的表格宽度写死绝对定位到左侧部分，把另一个表格盖住来实现的。当数据量较多的时候会非常卡顿。<br>后来我又研究了下ant-design里面的table组件固定列的实现方式，发现ant-design的实现方式跟element-ui不一样，它不是渲染两个table，而是基于一个CSS3属性来实现的，那就是 <code>position: sticky</code>。<br>sticky直译是粘性定位，MDN上是这样介绍的：</p>\n<p>元素根据正常文档流进行定位，然后相对它的最近滚动祖先（nearest scrolling ancestor）和 containing block (最近块级祖先 nearest block-level ancestor)，包括table-related元素，基于top, right, bottom, 和 left的值进行偏移。偏移值不会影响任何其他元素的位置。</p>\n<p>更多介绍请看：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/position\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/position</a></p>\n<p>然后我就尝试着使用原生html的table的结构和这个css属性实现了固定表头和列的表格组件，并添加了拖拽滚动的效果，首先看下效果：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table2.gif\"></p>\n<p>性能方面，经测试，每页1000条数据+100列的情况下，也比原来页面的50条流畅的多：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table3.gif\"></p>\n<p>遇到的坑：<br>滚动时固定行和列的左右边框会消失，我采用伪元素模拟右边框和下边框，并且给最外层容器添加左边框和上边框，<br>而且滚动时还有个莫名奇妙的问题，左边的文字竟然在那边框区域1px像素的区域显示出来一点，如图：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_225413.png\"></p>\n<p>采用模拟边框后这个问题也一并解决了。<br>z-index问题，z-index要从左上角至两边递减，左上角的th要把z-index设的最大，否则滚动时右边的的th和下面的td会把第一个th盖住。</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_224153.png\"></p>\n<p>td和th宽度问题：当列数较多的时候，我发现即使使用行内样式写死th和td的宽度，它们的宽度也不会生效，这个问题非常蛋疼，我后来使用了一个固定宽度的span元素写在td里面才解决这个问题。</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_103321.png\"></p>\n<p>性能优化：mousemove事件是高频事件，频繁触发也会造成性能问题，这里我使用lodash的throttle方法进行节流，每60毫秒触发一次，实际使用时请先安装<code>loadsh</code>, npm i lodash </p>\n<p>兼容性，只支持较新浏览器，不支持IE:</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_113828.png\"></p>\n<p>附上vue组件源码,FixedTable.vue，里面有原生html结构和el-table(注释部分)两种写法，使用el-table的话，页面数据超过50条已经有明显的卡顿</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;list-page-container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;query-box&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;mini&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;mini&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    &lt;div</span><br><span class=\"line\">      ref=&quot;table_wrapper&quot;</span><br><span class=\"line\">      class=&quot;table-wrapper&quot;</span><br><span class=\"line\">      style=&quot;border-top: 1px solid #cccccc; border-left: 1px solid #cccccc;&quot;</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;tbody&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fixed-table&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fixed-column&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;z-index: 300&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: inline-block; width: 50px;&quot;</span>&gt;</span>序号<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">            &lt;th</span><br><span class=\"line\">              v-for=&quot;(columnItem,index) in lebelData&quot;</span><br><span class=\"line\">              :key=&quot;index&quot;</span><br><span class=\"line\">              :class=&quot;fixedPropList.includes(columnItem.prop)?&#x27;fixed-column&#x27;:&#x27;&#x27;&quot;</span><br><span class=\"line\">              :style=&quot;fixedPropList.includes(columnItem.prop)?&#123;</span><br><span class=\"line\">                left:index * 100 + 50 + &#x27;px&#x27;,</span><br><span class=\"line\">                width: &#x27;100px&#x27;,</span><br><span class=\"line\">                zIndex: 2 + (200-index)</span><br><span class=\"line\">              &#125;:&#123;&#125;&quot;</span><br><span class=\"line\">            &gt;</span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: inline-block;width: 100px&quot;</span>&gt;</span></span><br><span class=\"line\">                &#123;&#123; columnItem.label &#125;&#125;</span><br><span class=\"line\">              <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(rowItem,index) in tableData&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fixed-column&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 50px;z-index: 200&quot;</span>&gt;</span></span><br><span class=\"line\">              &#123;&#123; index+1 &#125;&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            &lt;td</span><br><span class=\"line\">              v-for=&quot;(columnItem,cindex) in lebelData&quot;</span><br><span class=\"line\">              :key=&quot;cindex&quot;</span><br><span class=\"line\">              :class=&quot;fixedPropList.includes(columnItem.prop)?&#x27;fixed-column&#x27;:&#x27;&#x27;&quot;</span><br><span class=\"line\">              :style=&quot;fixedPropList.includes(columnItem.prop)?&#123;</span><br><span class=\"line\">                left: cindex * 100 + 50 + &#x27;px&#x27;,</span><br><span class=\"line\">                width: &#x27;100px&#x27;,</span><br><span class=\"line\">                zIndex: 1 + (100-cindex)</span><br><span class=\"line\">              &#125;:&#123;&#125;&quot;</span><br><span class=\"line\">            &gt;</span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: inline-block;width: 100px&quot;</span>&gt;</span></span><br><span class=\"line\">                &#123;&#123; rowItem[columnItem.prop] &#125;&#125;</span><br><span class=\"line\">              <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--&lt;el-table</span></span><br><span class=\"line\"><span class=\"comment\">        ref=&quot;drag_table&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        class=&quot;drag-table&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        :data=&quot;tableData&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        size=&quot;mini&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        border</span></span><br><span class=\"line\"><span class=\"comment\">        :height=&quot;tableHeight&quot;</span></span><br><span class=\"line\"><span class=\"comment\">      &gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;el-table-column</span></span><br><span class=\"line\"><span class=\"comment\">          type=&quot;index&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          fixed</span></span><br><span class=\"line\"><span class=\"comment\">          align=&quot;center&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          label=&quot;序号&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          width=&quot;50&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;el-table-column</span></span><br><span class=\"line\"><span class=\"comment\">          v-for=&quot;(columnItem,index) in lebelData&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :key=&quot;index&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          align=&quot;center&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :fixed=&quot;fixedPropList.includes(columnItem.prop)&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :prop=&quot;columnItem.prop&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :label=&quot;columnItem.label&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          width=&quot;90&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">      &lt;/el-table&gt;--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;list-page-footer&quot;</span>&gt;</span></span><br><span class=\"line\">      共&#123;&#123; tableData.length &#125;&#125;条数据</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> &#123; throttle &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;lodash&#x27;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/* 生成表格数据*/</span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">generateTableData</span>(<span class=\"params\">listLength, columnLength</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">const</span> arr = [];</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= listLength; i++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> obj = &#123;&#125;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">1</span>; j &lt;= columnLength; j++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      obj[<span class=\"string\">&#x27;label&#x27;</span> + j] = i + <span class=\"string\">&#x27;*&#x27;</span> + j + <span class=\"string\">&#x27;=&#x27;</span> + i * j;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr.push(obj)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">return</span> arr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/* 生成表格列数据*/</span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">generateLabelData</span>(<span class=\"params\">labelLength</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">const</span> arr = []</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= labelLength; i++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> obj = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      label: <span class=\"string\">&#x27;列&#x27;</span> + i,</span></span><br><span class=\"line\"><span class=\"javascript\">      prop: <span class=\"string\">&#x27;label&#x27;</span> + i</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr.push(obj)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">return</span> arr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  name: <span class=\"string\">&#x27;FixedTable&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      tableData: generateTableData(50, 30),</span><br><span class=\"line\">      lebelData: generateLabelData(30),</span><br><span class=\"line\">      tableHeight: 700,</span><br><span class=\"line\">      fixedPropList: [</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">&#x27;label1&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">&#x27;label2&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">      ], <span class=\"comment\">// 固定列数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">      clickPointX: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时的坐标</span></span></span><br><span class=\"line\"><span class=\"javascript\">      clickPointY: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时的坐标</span></span></span><br><span class=\"line\"><span class=\"javascript\">      scrollLeft: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时容器的滚动距离</span></span></span><br><span class=\"line\"><span class=\"javascript\">      scrollTop: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时容器的滚动距离</span></span></span><br><span class=\"line\"><span class=\"javascript\">      table_wrapper: <span class=\"literal\">null</span> <span class=\"comment\">// 滚动容器(表格父元素)</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"function\"><span class=\"title\">mounted</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">this</span>.setDraggable()</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">setDraggable</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// el-table组件写法</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// const table = this.$refs.drag_table</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// const table_wrapper = table.$el.querySelector(&#x27;.el-table__body-wrapper&#x27;)</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// const tbody = table.$el.querySelector(&#x27;.el-table__body-wrapper tbody&#x27;)</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">//</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 原生table写法</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">const</span> tbody = <span class=\"built_in\">this</span>.$refs.tbody</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">const</span> table_wrapper = <span class=\"built_in\">this</span>.$refs.table_wrapper</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"built_in\">this</span>.table_wrapper = table_wrapper</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      tbody.addEventListener(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"function\"><span class=\"params\">evt</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;鼠标按下&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.scrollLeft = table_wrapper.scrollLeft</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.scrollTop = table_wrapper.scrollTop</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.clickPointX = evt.x</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.clickPointY = evt.y</span></span><br><span class=\"line\"><span class=\"javascript\">        tbody.addEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, moveHandler)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"><span class=\"javascript\">      tbody.addEventListener(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"function\"><span class=\"params\">evt</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        tbody.removeEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, moveHandler)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"><span class=\"javascript\">      tbody.addEventListener(<span class=\"string\">&#x27;mouseleave&#x27;</span>, <span class=\"function\"><span class=\"params\">evt</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        tbody.removeEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, moveHandler)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">const</span> moveHandler = throttle(<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;鼠标移动&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// 我将表格滚动距离设置为鼠标移动距离的3倍，可根据实际情况设置成别的数值</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> newX = <span class=\"built_in\">this</span>.scrollLeft - (event.x - <span class=\"built_in\">this</span>.clickPointX) * <span class=\"number\">3</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> newY = <span class=\"built_in\">this</span>.scrollTop - (event.y - <span class=\"built_in\">this</span>.clickPointY) * <span class=\"number\">3</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.table_wrapper.scroll(newX, newY)</span></span><br><span class=\"line\">      &#125;, 60)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>之前看过不少文章说react在性能方面会比vue强不少，我简单学习了下react，用react也顺利实现了这个功能，react源码也一并附上，FixedTable.js:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; throttle &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;lodash&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FixedTable</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.fixedColumns = [</span><br><span class=\"line\">      <span class=\"string\">&#x27;label1&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;label2&#x27;</span>,</span><br><span class=\"line\">    ];</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.state = &#123;</span><br><span class=\"line\">      tableData: <span class=\"built_in\">this</span>.generateTableData(<span class=\"number\">100</span>, <span class=\"number\">50</span>),</span><br><span class=\"line\">      labelData: <span class=\"built_in\">this</span>.generateLabelData(<span class=\"number\">50</span>)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.table_wrapper = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setDraggable();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">setDraggable</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> wrapper_node = <span class=\"built_in\">this</span>.table_wrapper.current;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> scrollLeft = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> scrollTop = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> clickPointX = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> clickPointY = <span class=\"number\">0</span>;</span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;mousedown&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;鼠标按下&quot;</span>);</span><br><span class=\"line\">      scrollLeft = wrapper_node.scrollLeft;</span><br><span class=\"line\">      scrollTop = wrapper_node.scrollTop;</span><br><span class=\"line\">      clickPointX = evt.x;</span><br><span class=\"line\">      clickPointY = evt.y;</span><br><span class=\"line\">      wrapper_node.addEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      wrapper_node.removeEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;mouseleave&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      wrapper_node.removeEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;dragend&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      wrapper_node.removeEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> moveHandler = throttle(<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;moveHandler 触发&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 我将表格滚动距离设置为鼠标移动距离的3倍，可根据实际情况设置成别的数值</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> newX = scrollLeft - (event.x - clickPointX) * <span class=\"number\">3</span>;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newY = scrollTop - (event.y - clickPointY) * <span class=\"number\">3</span>;</span><br><span class=\"line\">      wrapper_node.scroll(newX, newY);</span><br><span class=\"line\">    &#125;, <span class=\"number\">60</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">generateTableData</span>(<span class=\"params\">listLength, columnLength</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= listLength; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> obj = &#123;&#125;;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">1</span>; j &lt;= columnLength; j++) &#123;</span><br><span class=\"line\">        obj[<span class=\"string\">&quot;label&quot;</span> + j] = i + <span class=\"string\">&quot;*&quot;</span> + j + <span class=\"string\">&quot;=&quot;</span> + i * j;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      arr.push(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 生成表格列数据*/</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">generateLabelData</span>(<span class=\"params\">labelLength</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= labelLength; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">        label: <span class=\"string\">&quot;列&quot;</span> + i,</span><br><span class=\"line\">        prop: <span class=\"string\">&quot;label&quot;</span> + i</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      arr.push(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=&#123;<span class=\"string\">&quot;table-wrapper&quot;</span>&#125; style=&#123;&#123;</span><br><span class=\"line\">        maxHeight: <span class=\"string\">&#x27;800px&#x27;</span></span><br><span class=\"line\">      &#125;&#125; ref=&#123;<span class=\"built_in\">this</span>.table_wrapper&#125;&gt;</span><br><span class=\"line\">        &lt;table className=&#123;<span class=\"string\">&quot;fixed-table&quot;</span>&#125;&gt;</span><br><span class=\"line\">          &lt;thead&gt;</span><br><span class=\"line\">          &lt;tr&gt;</span><br><span class=\"line\">            &lt;th className=&#123;<span class=\"string\">&#x27;fixed-column&#x27;</span>&#125; style=&#123;&#123;</span><br><span class=\"line\">              zIndex: <span class=\"number\">300</span></span><br><span class=\"line\">            &#125;&#125;&gt;</span><br><span class=\"line\">                &lt;span style=&#123;&#123;</span><br><span class=\"line\">                  display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                  width: <span class=\"string\">&#x27;50px&#x27;</span></span><br><span class=\"line\">                &#125;&#125;&gt;序号&lt;/span&gt;</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">            &#123;<span class=\"built_in\">this</span>.state.labelData.map(<span class=\"function\">(<span class=\"params\">columnItem, columnItemIndex</span>) =&gt;</span></span><br><span class=\"line\">              &lt;th key=&#123;columnItemIndex&#125;</span><br><span class=\"line\">                  className=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? <span class=\"string\">&#x27;fixed-column&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>&#125;</span><br><span class=\"line\">                  style=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? &#123;</span><br><span class=\"line\">                    left: columnItemIndex * <span class=\"number\">100</span> + <span class=\"number\">50</span> + <span class=\"string\">&#x27;px&#x27;</span>,</span><br><span class=\"line\">                    width: <span class=\"string\">&#x27;100px&#x27;</span>,</span><br><span class=\"line\">                    zIndex: <span class=\"number\">2</span> + (<span class=\"number\">100</span> - columnItemIndex)</span><br><span class=\"line\">                  &#125; : &#123;&#125;&#125;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;span style=&#123;&#123;</span><br><span class=\"line\">                  display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                  width: <span class=\"string\">&#x27;100px&#x27;</span></span><br><span class=\"line\">                &#125;&#125;&gt;</span><br><span class=\"line\">                  &#123;columnItem.label&#125;</span><br><span class=\"line\">                &lt;/span&gt;</span><br><span class=\"line\">              &lt;/th&gt;</span><br><span class=\"line\">            )&#125;</span><br><span class=\"line\">          &lt;/tr&gt;</span><br><span class=\"line\">          &lt;/thead&gt;</span><br><span class=\"line\">          &lt;tbody&gt;</span><br><span class=\"line\">          &#123;<span class=\"built_in\">this</span>.state.tableData.map(<span class=\"function\">(<span class=\"params\">item, itemIndex</span>) =&gt;</span></span><br><span class=\"line\">            &lt;tr key=&#123;itemIndex&#125;&gt;</span><br><span class=\"line\">              &lt;td className=&#123;<span class=\"string\">&#x27;fixed-column&#x27;</span>&#125; style=&#123;&#123;</span><br><span class=\"line\">                zIndex: <span class=\"number\">200</span></span><br><span class=\"line\">              &#125;&#125;&gt;</span><br><span class=\"line\">                &lt;span style=&#123;&#123;</span><br><span class=\"line\">                  display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                  width: <span class=\"string\">&#x27;50px&#x27;</span></span><br><span class=\"line\">                &#125;&#125;&gt;序号&lt;/span&gt;</span><br><span class=\"line\">              &lt;/td&gt;</span><br><span class=\"line\">              &#123;<span class=\"built_in\">this</span>.state.labelData.map(<span class=\"function\">(<span class=\"params\">columnItem, columnItemIndex</span>) =&gt;</span></span><br><span class=\"line\">                &lt;td key=&#123;columnItemIndex&#125;</span><br><span class=\"line\">                    className=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? <span class=\"string\">&#x27;fixed-column&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>&#125;</span><br><span class=\"line\">                    style=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? &#123;</span><br><span class=\"line\">                      left: columnItemIndex * <span class=\"number\">100</span> + <span class=\"number\">50</span> + <span class=\"string\">&#x27;px&#x27;</span>,</span><br><span class=\"line\">                      width: <span class=\"string\">&#x27;100px&#x27;</span>,</span><br><span class=\"line\">                      zIndex: <span class=\"number\">1</span> + (<span class=\"number\">100</span> - columnItemIndex)</span><br><span class=\"line\">                    &#125; : &#123;&#125;&#125;</span><br><span class=\"line\">                &gt;</span><br><span class=\"line\">                  &lt;span style=&#123;&#123;</span><br><span class=\"line\">                    display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                    width: <span class=\"string\">&#x27;100px&#x27;</span></span><br><span class=\"line\">                  &#125;&#125;&gt;</span><br><span class=\"line\">                    &#123;item[columnItem.prop]&#125;</span><br><span class=\"line\">                  &lt;/span&gt;</span><br><span class=\"line\">                &lt;/td&gt;</span><br><span class=\"line\">              )&#125;</span><br><span class=\"line\">            &lt;/tr&gt;</span><br><span class=\"line\">          )&#125;</span><br><span class=\"line\">          &lt;/tbody&gt;</span><br><span class=\"line\">        &lt;/table&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> FixedTable;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下面是样式文件,fixed-table.sass:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.table-wrapper</span><br><span class=\"line\">\t-webkit-touch-callout: none</span><br><span class=\"line\">\t-webkit-user-select: none</span><br><span class=\"line\">\t-khtml-user-select: none</span><br><span class=\"line\">\t-moz-user-select: none</span><br><span class=\"line\">\t-ms-user-select: none</span><br><span class=\"line\">\tuser-select: none</span><br><span class=\"line\">\tmax-height: 800px</span><br><span class=\"line\">\toverflow: auto</span><br><span class=\"line\">\t.fixed-table</span><br><span class=\"line\">\t\tborder-collapse: collapse</span><br><span class=\"line\">\t\ttable-layout: fixed</span><br><span class=\"line\">\t\tth, td</span><br><span class=\"line\">\t\t\ttext-align: center</span><br><span class=\"line\">\t\t\tfont-size: 12px</span><br><span class=\"line\">\t\t\tcolor: #666</span><br><span class=\"line\">\t\t\tpadding: 10px 0</span><br><span class=\"line\">\t\t\tposition: relative</span><br><span class=\"line\">\t\t\t&amp;:after</span><br><span class=\"line\">\t\t\t\tcontent: &#39;&#39;</span><br><span class=\"line\">\t\t\t\tdisplay: block</span><br><span class=\"line\">\t\t\t\twidth: 1px</span><br><span class=\"line\">\t\t\t\theight: 100%</span><br><span class=\"line\">\t\t\t\tbackground-color: #cccccc</span><br><span class=\"line\">\t\t\t\tposition: absolute</span><br><span class=\"line\">\t\t\t\tright: 0</span><br><span class=\"line\">\t\t\t\ttop: 0</span><br><span class=\"line\">\t\t\t&amp;:before</span><br><span class=\"line\">\t\t\t\tcontent: &#39;&#39;</span><br><span class=\"line\">\t\t\t\tdisplay: block</span><br><span class=\"line\">\t\t\t\twidth: 100%</span><br><span class=\"line\">\t\t\t\theight: 1px</span><br><span class=\"line\">\t\t\t\tbackground-color: #cccccc</span><br><span class=\"line\">\t\t\t\tposition: absolute</span><br><span class=\"line\">\t\t\t\tleft: 0</span><br><span class=\"line\">\t\t\t\tbottom: 0</span><br><span class=\"line\">\t\t\t&amp;.fixed-column</span><br><span class=\"line\">\t\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\t\tbackground-color: #eeeeee</span><br><span class=\"line\">\t\tth</span><br><span class=\"line\">\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\ttop: 0</span><br><span class=\"line\">\t\t\tz-index: 3</span><br><span class=\"line\">\t\t\tbackground-color: #eeeeee</span><br><span class=\"line\">\t\t\tfont-weight: bold</span><br><span class=\"line\">\t\tth:first-child</span><br><span class=\"line\">\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\tleft: 0</span><br><span class=\"line\">\t\t\ttop: 0</span><br><span class=\"line\">\t\t\tz-index: 4</span><br><span class=\"line\">\t\ttd:first-child</span><br><span class=\"line\">\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\tleft: 0</span><br><span class=\"line\">\t\t\tz-index: 3</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>顺便附上一个el-table高度自适应的mixin组件，可以实现窗口变化时也能自适应高度，如下效果：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/resize-table1.gif\"></p>\n<p>ListPageResizeHandler.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; throttle &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;lodash&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      tableHeight: <span class=\"number\">700</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">mounted</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> observeContainer = throttle(<span class=\"function\"><span class=\"params\">entries</span> =&gt;</span> &#123;</span><br><span class=\"line\">      entries.forEach(<span class=\"function\"><span class=\"params\">entry</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> cr = entry.contentRect</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tableHeight = cr.height</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;, <span class=\"number\">200</span>, &#123; <span class=\"attr\">leading</span>: <span class=\"literal\">false</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> observer = <span class=\"keyword\">new</span> ResizeObserver(observeContainer)</span><br><span class=\"line\">    observer.observe(<span class=\"built_in\">this</span>.$refs.table_wrapper)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.$once(<span class=\"string\">&#x27;hook:beforeDestroy&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      observer.disconnect()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>使用方法:引入文件并在vue组件里声明 </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--....--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> &gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> ListPageResizeHandler <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/mixin/ListPageResizeHandler&#x27;</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//....</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">mixins: [ListPageResizeHandler],</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//....</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p style=\"visibility: hidden;\">\n<span>可拖拽表格</span>\n<span>可拖拽的表格</span>\n<span>拖拽的表格</span>\n<span>拖拽滚动表格</span>\n<span>拖拽滚动</span>\n<span>表格固定表头</span>\n<span>表格固定列</span>\n</p>\n\n","more":"<p>最近重构的项目中有这样一个页面，一个固定表头和列的表格，表格列数较多，大概有60多列，200多条数据，而且表格需要实现拖拽滚动功能。<br>原页面的表格是用的一个比较老旧的表格插件实现，拖拽滚动是用iScroll.js实现的，性能很差，即使每页只有二、三十条数据，拖拽起来也严重卡顿。我首先使用了element-ui自带的的table组件实现了拖拽滚动的功能，性能稍微比老页面强了一点，每页50条数据时卡顿不明显，超过100条数据时有才有卡顿感。然而我对这样的性能也不是很满意，就研究了下el-table固定表头和列的实现方式，发现el-table实现固定列的方式比较坑，它是渲染了两个完整的table，然后把固定列的表格宽度写死绝对定位到左侧部分，把另一个表格盖住来实现的。当数据量较多的时候会非常卡顿。<br>后来我又研究了下ant-design里面的table组件固定列的实现方式，发现ant-design的实现方式跟element-ui不一样，它不是渲染两个table，而是基于一个CSS3属性来实现的，那就是 <code>position: sticky</code>。<br>sticky直译是粘性定位，MDN上是这样介绍的：</p>\n<p>元素根据正常文档流进行定位，然后相对它的最近滚动祖先（nearest scrolling ancestor）和 containing block (最近块级祖先 nearest block-level ancestor)，包括table-related元素，基于top, right, bottom, 和 left的值进行偏移。偏移值不会影响任何其他元素的位置。</p>\n<p>更多介绍请看：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/position\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/position</a></p>\n<p>然后我就尝试着使用原生html的table的结构和这个css属性实现了固定表头和列的表格组件，并添加了拖拽滚动的效果，首先看下效果：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table2.gif\"></p>\n<p>性能方面，经测试，每页1000条数据+100列的情况下，也比原来页面的50条流畅的多：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table3.gif\"></p>\n<p>遇到的坑：<br>滚动时固定行和列的左右边框会消失，我采用伪元素模拟右边框和下边框，并且给最外层容器添加左边框和上边框，<br>而且滚动时还有个莫名奇妙的问题，左边的文字竟然在那边框区域1px像素的区域显示出来一点，如图：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_225413.png\"></p>\n<p>采用模拟边框后这个问题也一并解决了。<br>z-index问题，z-index要从左上角至两边递减，左上角的th要把z-index设的最大，否则滚动时右边的的th和下面的td会把第一个th盖住。</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_224153.png\"></p>\n<p>td和th宽度问题：当列数较多的时候，我发现即使使用行内样式写死th和td的宽度，它们的宽度也不会生效，这个问题非常蛋疼，我后来使用了一个固定宽度的span元素写在td里面才解决这个问题。</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_103321.png\"></p>\n<p>性能优化：mousemove事件是高频事件，频繁触发也会造成性能问题，这里我使用lodash的throttle方法进行节流，每60毫秒触发一次，实际使用时请先安装<code>loadsh</code>, npm i lodash </p>\n<p>兼容性，只支持较新浏览器，不支持IE:</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_113828.png\"></p>\n<p>附上vue组件源码,FixedTable.vue，里面有原生html结构和el-table(注释部分)两种写法，使用el-table的话，页面数据超过50条已经有明显的卡顿</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;list-page-container&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;query-box&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;mini&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;mini&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span>&gt;</span>按钮<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    &lt;div</span><br><span class=\"line\">      ref=&quot;table_wrapper&quot;</span><br><span class=\"line\">      class=&quot;table-wrapper&quot;</span><br><span class=\"line\">      style=&quot;border-top: 1px solid #cccccc; border-left: 1px solid #cccccc;&quot;</span><br><span class=\"line\">    &gt;</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">table</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;tbody&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fixed-table&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">th</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fixed-column&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;z-index: 300&quot;</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: inline-block; width: 50px;&quot;</span>&gt;</span>序号<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">            &lt;th</span><br><span class=\"line\">              v-for=&quot;(columnItem,index) in lebelData&quot;</span><br><span class=\"line\">              :key=&quot;index&quot;</span><br><span class=\"line\">              :class=&quot;fixedPropList.includes(columnItem.prop)?&#x27;fixed-column&#x27;:&#x27;&#x27;&quot;</span><br><span class=\"line\">              :style=&quot;fixedPropList.includes(columnItem.prop)?&#123;</span><br><span class=\"line\">                left:index * 100 + 50 + &#x27;px&#x27;,</span><br><span class=\"line\">                width: &#x27;100px&#x27;,</span><br><span class=\"line\">                zIndex: 2 + (200-index)</span><br><span class=\"line\">              &#125;:&#123;&#125;&quot;</span><br><span class=\"line\">            &gt;</span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: inline-block;width: 100px&quot;</span>&gt;</span></span><br><span class=\"line\">                &#123;&#123; columnItem.label &#125;&#125;</span><br><span class=\"line\">              <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(rowItem,index) in tableData&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fixed-column&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 50px;z-index: 200&quot;</span>&gt;</span></span><br><span class=\"line\">              &#123;&#123; index+1 &#125;&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">            &lt;td</span><br><span class=\"line\">              v-for=&quot;(columnItem,cindex) in lebelData&quot;</span><br><span class=\"line\">              :key=&quot;cindex&quot;</span><br><span class=\"line\">              :class=&quot;fixedPropList.includes(columnItem.prop)?&#x27;fixed-column&#x27;:&#x27;&#x27;&quot;</span><br><span class=\"line\">              :style=&quot;fixedPropList.includes(columnItem.prop)?&#123;</span><br><span class=\"line\">                left: cindex * 100 + 50 + &#x27;px&#x27;,</span><br><span class=\"line\">                width: &#x27;100px&#x27;,</span><br><span class=\"line\">                zIndex: 1 + (100-cindex)</span><br><span class=\"line\">              &#125;:&#123;&#125;&quot;</span><br><span class=\"line\">            &gt;</span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;display: inline-block;width: 100px&quot;</span>&gt;</span></span><br><span class=\"line\">                &#123;&#123; rowItem[columnItem.prop] &#125;&#125;</span><br><span class=\"line\">              <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--&lt;el-table</span></span><br><span class=\"line\"><span class=\"comment\">        ref=&quot;drag_table&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        class=&quot;drag-table&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        :data=&quot;tableData&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        size=&quot;mini&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        border</span></span><br><span class=\"line\"><span class=\"comment\">        :height=&quot;tableHeight&quot;</span></span><br><span class=\"line\"><span class=\"comment\">      &gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;el-table-column</span></span><br><span class=\"line\"><span class=\"comment\">          type=&quot;index&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          fixed</span></span><br><span class=\"line\"><span class=\"comment\">          align=&quot;center&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          label=&quot;序号&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          width=&quot;50&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;el-table-column</span></span><br><span class=\"line\"><span class=\"comment\">          v-for=&quot;(columnItem,index) in lebelData&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :key=&quot;index&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          align=&quot;center&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :fixed=&quot;fixedPropList.includes(columnItem.prop)&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :prop=&quot;columnItem.prop&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          :label=&quot;columnItem.label&quot;</span></span><br><span class=\"line\"><span class=\"comment\">          width=&quot;90&quot;</span></span><br><span class=\"line\"><span class=\"comment\">        /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">      &lt;/el-table&gt;--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;list-page-footer&quot;</span>&gt;</span></span><br><span class=\"line\">      共&#123;&#123; tableData.length &#125;&#125;条数据</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> &#123; throttle &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;lodash&#x27;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/* 生成表格数据*/</span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">generateTableData</span>(<span class=\"params\">listLength, columnLength</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">const</span> arr = [];</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= listLength; i++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> obj = &#123;&#125;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">1</span>; j &lt;= columnLength; j++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      obj[<span class=\"string\">&#x27;label&#x27;</span> + j] = i + <span class=\"string\">&#x27;*&#x27;</span> + j + <span class=\"string\">&#x27;=&#x27;</span> + i * j;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr.push(obj)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">return</span> arr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">/* 生成表格列数据*/</span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">generateLabelData</span>(<span class=\"params\">labelLength</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">const</span> arr = []</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= labelLength; i++) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> obj = &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      label: <span class=\"string\">&#x27;列&#x27;</span> + i,</span></span><br><span class=\"line\"><span class=\"javascript\">      prop: <span class=\"string\">&#x27;label&#x27;</span> + i</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr.push(obj)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"keyword\">return</span> arr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">  name: <span class=\"string\">&#x27;FixedTable&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      tableData: generateTableData(50, 30),</span><br><span class=\"line\">      lebelData: generateLabelData(30),</span><br><span class=\"line\">      tableHeight: 700,</span><br><span class=\"line\">      fixedPropList: [</span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">&#x27;label1&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"string\">&#x27;label2&#x27;</span></span></span><br><span class=\"line\"><span class=\"javascript\">      ], <span class=\"comment\">// 固定列数据</span></span></span><br><span class=\"line\"><span class=\"javascript\">      clickPointX: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时的坐标</span></span></span><br><span class=\"line\"><span class=\"javascript\">      clickPointY: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时的坐标</span></span></span><br><span class=\"line\"><span class=\"javascript\">      scrollLeft: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时容器的滚动距离</span></span></span><br><span class=\"line\"><span class=\"javascript\">      scrollTop: <span class=\"number\">0</span>, <span class=\"comment\">// 鼠标按下时容器的滚动距离</span></span></span><br><span class=\"line\"><span class=\"javascript\">      table_wrapper: <span class=\"literal\">null</span> <span class=\"comment\">// 滚动容器(表格父元素)</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"javascript\">  <span class=\"function\"><span class=\"title\">mounted</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">this</span>.setDraggable()</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"function\"><span class=\"title\">setDraggable</span>(<span class=\"params\"></span>)</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// el-table组件写法</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// const table = this.$refs.drag_table</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// const table_wrapper = table.$el.querySelector(&#x27;.el-table__body-wrapper&#x27;)</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// const tbody = table.$el.querySelector(&#x27;.el-table__body-wrapper tbody&#x27;)</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">//</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 原生table写法</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">const</span> tbody = <span class=\"built_in\">this</span>.$refs.tbody</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">const</span> table_wrapper = <span class=\"built_in\">this</span>.$refs.table_wrapper</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"built_in\">this</span>.table_wrapper = table_wrapper</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">      tbody.addEventListener(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"function\"><span class=\"params\">evt</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;鼠标按下&#x27;</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.scrollLeft = table_wrapper.scrollLeft</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.scrollTop = table_wrapper.scrollTop</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.clickPointX = evt.x</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.clickPointY = evt.y</span></span><br><span class=\"line\"><span class=\"javascript\">        tbody.addEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, moveHandler)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"><span class=\"javascript\">      tbody.addEventListener(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"function\"><span class=\"params\">evt</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        tbody.removeEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, moveHandler)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"><span class=\"javascript\">      tbody.addEventListener(<span class=\"string\">&#x27;mouseleave&#x27;</span>, <span class=\"function\"><span class=\"params\">evt</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        tbody.removeEventListener(<span class=\"string\">&#x27;mousemove&#x27;</span>, moveHandler)</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">const</span> moveHandler = throttle(<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;鼠标移动&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// 我将表格滚动距离设置为鼠标移动距离的3倍，可根据实际情况设置成别的数值</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> newX = <span class=\"built_in\">this</span>.scrollLeft - (event.x - <span class=\"built_in\">this</span>.clickPointX) * <span class=\"number\">3</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">const</span> newY = <span class=\"built_in\">this</span>.scrollTop - (event.y - <span class=\"built_in\">this</span>.clickPointY) * <span class=\"number\">3</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">this</span>.table_wrapper.scroll(newX, newY)</span></span><br><span class=\"line\">      &#125;, 60)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>之前看过不少文章说react在性能方面会比vue强不少，我简单学习了下react，用react也顺利实现了这个功能，react源码也一并附上，FixedTable.js:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">&quot;react&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; throttle &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;lodash&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FixedTable</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.fixedColumns = [</span><br><span class=\"line\">      <span class=\"string\">&#x27;label1&#x27;</span>,</span><br><span class=\"line\">      <span class=\"string\">&#x27;label2&#x27;</span>,</span><br><span class=\"line\">    ];</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.state = &#123;</span><br><span class=\"line\">      tableData: <span class=\"built_in\">this</span>.generateTableData(<span class=\"number\">100</span>, <span class=\"number\">50</span>),</span><br><span class=\"line\">      labelData: <span class=\"built_in\">this</span>.generateLabelData(<span class=\"number\">50</span>)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.table_wrapper = React.createRef();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.setDraggable();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">setDraggable</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> wrapper_node = <span class=\"built_in\">this</span>.table_wrapper.current;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> scrollLeft = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> scrollTop = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> clickPointX = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> clickPointY = <span class=\"number\">0</span>;</span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;mousedown&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;鼠标按下&quot;</span>);</span><br><span class=\"line\">      scrollLeft = wrapper_node.scrollLeft;</span><br><span class=\"line\">      scrollTop = wrapper_node.scrollTop;</span><br><span class=\"line\">      clickPointX = evt.x;</span><br><span class=\"line\">      clickPointY = evt.y;</span><br><span class=\"line\">      wrapper_node.addEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;mouseup&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      wrapper_node.removeEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;mouseleave&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      wrapper_node.removeEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    wrapper_node.addEventListener(<span class=\"string\">&quot;dragend&quot;</span>, <span class=\"function\">(<span class=\"params\">evt</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      wrapper_node.removeEventListener(<span class=\"string\">&quot;mousemove&quot;</span>, moveHandler);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> moveHandler = throttle(<span class=\"function\"><span class=\"params\">event</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;moveHandler 触发&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 我将表格滚动距离设置为鼠标移动距离的3倍，可根据实际情况设置成别的数值</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> newX = scrollLeft - (event.x - clickPointX) * <span class=\"number\">3</span>;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newY = scrollTop - (event.y - clickPointY) * <span class=\"number\">3</span>;</span><br><span class=\"line\">      wrapper_node.scroll(newX, newY);</span><br><span class=\"line\">    &#125;, <span class=\"number\">60</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">generateTableData</span>(<span class=\"params\">listLength, columnLength</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= listLength; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> obj = &#123;&#125;;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">1</span>; j &lt;= columnLength; j++) &#123;</span><br><span class=\"line\">        obj[<span class=\"string\">&quot;label&quot;</span> + j] = i + <span class=\"string\">&quot;*&quot;</span> + j + <span class=\"string\">&quot;=&quot;</span> + i * j;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      arr.push(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* 生成表格列数据*/</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">generateLabelData</span>(<span class=\"params\">labelLength</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> arr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt;= labelLength; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> obj = &#123;</span><br><span class=\"line\">        label: <span class=\"string\">&quot;列&quot;</span> + i,</span><br><span class=\"line\">        prop: <span class=\"string\">&quot;label&quot;</span> + i</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      arr.push(obj);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=&#123;<span class=\"string\">&quot;table-wrapper&quot;</span>&#125; style=&#123;&#123;</span><br><span class=\"line\">        maxHeight: <span class=\"string\">&#x27;800px&#x27;</span></span><br><span class=\"line\">      &#125;&#125; ref=&#123;<span class=\"built_in\">this</span>.table_wrapper&#125;&gt;</span><br><span class=\"line\">        &lt;table className=&#123;<span class=\"string\">&quot;fixed-table&quot;</span>&#125;&gt;</span><br><span class=\"line\">          &lt;thead&gt;</span><br><span class=\"line\">          &lt;tr&gt;</span><br><span class=\"line\">            &lt;th className=&#123;<span class=\"string\">&#x27;fixed-column&#x27;</span>&#125; style=&#123;&#123;</span><br><span class=\"line\">              zIndex: <span class=\"number\">300</span></span><br><span class=\"line\">            &#125;&#125;&gt;</span><br><span class=\"line\">                &lt;span style=&#123;&#123;</span><br><span class=\"line\">                  display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                  width: <span class=\"string\">&#x27;50px&#x27;</span></span><br><span class=\"line\">                &#125;&#125;&gt;序号&lt;/span&gt;</span><br><span class=\"line\">            &lt;/th&gt;</span><br><span class=\"line\">            &#123;<span class=\"built_in\">this</span>.state.labelData.map(<span class=\"function\">(<span class=\"params\">columnItem, columnItemIndex</span>) =&gt;</span></span><br><span class=\"line\">              &lt;th key=&#123;columnItemIndex&#125;</span><br><span class=\"line\">                  className=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? <span class=\"string\">&#x27;fixed-column&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>&#125;</span><br><span class=\"line\">                  style=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? &#123;</span><br><span class=\"line\">                    left: columnItemIndex * <span class=\"number\">100</span> + <span class=\"number\">50</span> + <span class=\"string\">&#x27;px&#x27;</span>,</span><br><span class=\"line\">                    width: <span class=\"string\">&#x27;100px&#x27;</span>,</span><br><span class=\"line\">                    zIndex: <span class=\"number\">2</span> + (<span class=\"number\">100</span> - columnItemIndex)</span><br><span class=\"line\">                  &#125; : &#123;&#125;&#125;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;span style=&#123;&#123;</span><br><span class=\"line\">                  display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                  width: <span class=\"string\">&#x27;100px&#x27;</span></span><br><span class=\"line\">                &#125;&#125;&gt;</span><br><span class=\"line\">                  &#123;columnItem.label&#125;</span><br><span class=\"line\">                &lt;/span&gt;</span><br><span class=\"line\">              &lt;/th&gt;</span><br><span class=\"line\">            )&#125;</span><br><span class=\"line\">          &lt;/tr&gt;</span><br><span class=\"line\">          &lt;/thead&gt;</span><br><span class=\"line\">          &lt;tbody&gt;</span><br><span class=\"line\">          &#123;<span class=\"built_in\">this</span>.state.tableData.map(<span class=\"function\">(<span class=\"params\">item, itemIndex</span>) =&gt;</span></span><br><span class=\"line\">            &lt;tr key=&#123;itemIndex&#125;&gt;</span><br><span class=\"line\">              &lt;td className=&#123;<span class=\"string\">&#x27;fixed-column&#x27;</span>&#125; style=&#123;&#123;</span><br><span class=\"line\">                zIndex: <span class=\"number\">200</span></span><br><span class=\"line\">              &#125;&#125;&gt;</span><br><span class=\"line\">                &lt;span style=&#123;&#123;</span><br><span class=\"line\">                  display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                  width: <span class=\"string\">&#x27;50px&#x27;</span></span><br><span class=\"line\">                &#125;&#125;&gt;序号&lt;/span&gt;</span><br><span class=\"line\">              &lt;/td&gt;</span><br><span class=\"line\">              &#123;<span class=\"built_in\">this</span>.state.labelData.map(<span class=\"function\">(<span class=\"params\">columnItem, columnItemIndex</span>) =&gt;</span></span><br><span class=\"line\">                &lt;td key=&#123;columnItemIndex&#125;</span><br><span class=\"line\">                    className=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? <span class=\"string\">&#x27;fixed-column&#x27;</span> : <span class=\"string\">&#x27;&#x27;</span>&#125;</span><br><span class=\"line\">                    style=&#123;<span class=\"built_in\">this</span>.fixedColumns.includes(columnItem.prop) ? &#123;</span><br><span class=\"line\">                      left: columnItemIndex * <span class=\"number\">100</span> + <span class=\"number\">50</span> + <span class=\"string\">&#x27;px&#x27;</span>,</span><br><span class=\"line\">                      width: <span class=\"string\">&#x27;100px&#x27;</span>,</span><br><span class=\"line\">                      zIndex: <span class=\"number\">1</span> + (<span class=\"number\">100</span> - columnItemIndex)</span><br><span class=\"line\">                    &#125; : &#123;&#125;&#125;</span><br><span class=\"line\">                &gt;</span><br><span class=\"line\">                  &lt;span style=&#123;&#123;</span><br><span class=\"line\">                    display: <span class=\"string\">&#x27;inline-block&#x27;</span>,</span><br><span class=\"line\">                    width: <span class=\"string\">&#x27;100px&#x27;</span></span><br><span class=\"line\">                  &#125;&#125;&gt;</span><br><span class=\"line\">                    &#123;item[columnItem.prop]&#125;</span><br><span class=\"line\">                  &lt;/span&gt;</span><br><span class=\"line\">                &lt;/td&gt;</span><br><span class=\"line\">              )&#125;</span><br><span class=\"line\">            &lt;/tr&gt;</span><br><span class=\"line\">          )&#125;</span><br><span class=\"line\">          &lt;/tbody&gt;</span><br><span class=\"line\">        &lt;/table&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> FixedTable;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下面是样式文件,fixed-table.sass:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.table-wrapper</span><br><span class=\"line\">\t-webkit-touch-callout: none</span><br><span class=\"line\">\t-webkit-user-select: none</span><br><span class=\"line\">\t-khtml-user-select: none</span><br><span class=\"line\">\t-moz-user-select: none</span><br><span class=\"line\">\t-ms-user-select: none</span><br><span class=\"line\">\tuser-select: none</span><br><span class=\"line\">\tmax-height: 800px</span><br><span class=\"line\">\toverflow: auto</span><br><span class=\"line\">\t.fixed-table</span><br><span class=\"line\">\t\tborder-collapse: collapse</span><br><span class=\"line\">\t\ttable-layout: fixed</span><br><span class=\"line\">\t\tth, td</span><br><span class=\"line\">\t\t\ttext-align: center</span><br><span class=\"line\">\t\t\tfont-size: 12px</span><br><span class=\"line\">\t\t\tcolor: #666</span><br><span class=\"line\">\t\t\tpadding: 10px 0</span><br><span class=\"line\">\t\t\tposition: relative</span><br><span class=\"line\">\t\t\t&amp;:after</span><br><span class=\"line\">\t\t\t\tcontent: &#39;&#39;</span><br><span class=\"line\">\t\t\t\tdisplay: block</span><br><span class=\"line\">\t\t\t\twidth: 1px</span><br><span class=\"line\">\t\t\t\theight: 100%</span><br><span class=\"line\">\t\t\t\tbackground-color: #cccccc</span><br><span class=\"line\">\t\t\t\tposition: absolute</span><br><span class=\"line\">\t\t\t\tright: 0</span><br><span class=\"line\">\t\t\t\ttop: 0</span><br><span class=\"line\">\t\t\t&amp;:before</span><br><span class=\"line\">\t\t\t\tcontent: &#39;&#39;</span><br><span class=\"line\">\t\t\t\tdisplay: block</span><br><span class=\"line\">\t\t\t\twidth: 100%</span><br><span class=\"line\">\t\t\t\theight: 1px</span><br><span class=\"line\">\t\t\t\tbackground-color: #cccccc</span><br><span class=\"line\">\t\t\t\tposition: absolute</span><br><span class=\"line\">\t\t\t\tleft: 0</span><br><span class=\"line\">\t\t\t\tbottom: 0</span><br><span class=\"line\">\t\t\t&amp;.fixed-column</span><br><span class=\"line\">\t\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\t\tbackground-color: #eeeeee</span><br><span class=\"line\">\t\tth</span><br><span class=\"line\">\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\ttop: 0</span><br><span class=\"line\">\t\t\tz-index: 3</span><br><span class=\"line\">\t\t\tbackground-color: #eeeeee</span><br><span class=\"line\">\t\t\tfont-weight: bold</span><br><span class=\"line\">\t\tth:first-child</span><br><span class=\"line\">\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\tleft: 0</span><br><span class=\"line\">\t\t\ttop: 0</span><br><span class=\"line\">\t\t\tz-index: 4</span><br><span class=\"line\">\t\ttd:first-child</span><br><span class=\"line\">\t\t\tposition: sticky</span><br><span class=\"line\">\t\t\tleft: 0</span><br><span class=\"line\">\t\t\tz-index: 3</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>顺便附上一个el-table高度自适应的mixin组件，可以实现窗口变化时也能自适应高度，如下效果：</p>\n<p><img src=\"https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/resize-table1.gif\"></p>\n<p>ListPageResizeHandler.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; throttle &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;lodash&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      tableHeight: <span class=\"number\">700</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">mounted</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> observeContainer = throttle(<span class=\"function\"><span class=\"params\">entries</span> =&gt;</span> &#123;</span><br><span class=\"line\">      entries.forEach(<span class=\"function\"><span class=\"params\">entry</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> cr = entry.contentRect</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.tableHeight = cr.height</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;, <span class=\"number\">200</span>, &#123; <span class=\"attr\">leading</span>: <span class=\"literal\">false</span> &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> observer = <span class=\"keyword\">new</span> ResizeObserver(observeContainer)</span><br><span class=\"line\">    observer.observe(<span class=\"built_in\">this</span>.$refs.table_wrapper)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.$once(<span class=\"string\">&#x27;hook:beforeDestroy&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      observer.disconnect()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>使用方法:引入文件并在vue组件里声明 </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--....--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> &gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">import</span> ListPageResizeHandler <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@/mixin/ListPageResizeHandler&#x27;</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//....</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">mixins: [ListPageResizeHandler],</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//....</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p style=\"visibility: hidden;\">\n<span>可拖拽表格</span>\n<span>可拖拽的表格</span>\n<span>拖拽的表格</span>\n<span>拖拽滚动表格</span>\n<span>拖拽滚动</span>\n<span>表格固定表头</span>\n<span>表格固定列</span>\n</p>\n\n","categories":[{"name":"技术分享","path":"api/categories/技术分享.json"}],"tags":[{"name":"vue","path":"api/tags/vue.json"},{"name":"CSS","path":"api/tags/CSS.json"},{"name":"react","path":"api/tags/react.json"},{"name":"表格","path":"api/tags/表格.json"}]}